<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@yacobolo/datastar-prop - Property Binding for Lit Components</title>
    <meta name="description" content="A Datastar plugin for binding reactive signals to Lit web component properties with deep reactivity support">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>%E2%9A%A1</text></svg>">
    
    <!-- Open Props - Design tokens -->
    <link rel="stylesheet" href="https://unpkg.com/open-props">
    <link rel="stylesheet" href="https://unpkg.com/open-props/normalize.min.css">
    
    <!-- App styles - bundled with CSS layers -->
    <link rel="stylesheet" href="./demo/dist/styles.css">
</head>
<body>
    <div class="container" data-signals='{
        "flow": {
            "nodes": [
                { "id": "1", "label": "Input", "x": 80, "y": 80, "color": "#6366f1" },
                { "id": "2", "label": "Process", "x": 220, "y": 150, "color": "#a855f7" },
                { "id": "3", "label": "Output", "x": 360, "y": 80, "color": "#10b981" }
            ],
            "edges": [
                { "id": "1", "source": "1", "target": "2" },
                { "id": "2", "source": "2", "target": "3" }
            ],
            "config": {
                "nodeRadius": 30,
                "lineWidth": 2,
                "animate": true
            }
        },
        "scene": {
            "config": {
                "rotationSpeed": 0.01,
                "color": "#6366f1",
                "wireframe": false,
                "shape": "cube",
                "cameraZ": 5
            }
        },
        "chart": {
            "data": [
                { "name": "Mon", "value": 120 },
                { "name": "Tue", "value": 200 },
                { "name": "Wed", "value": 150 },
                { "name": "Thu", "value": 80 },
                { "name": "Fri", "value": 250 },
                { "name": "Sat", "value": 180 },
                { "name": "Sun", "value": 90 }
            ],
            "config": {
                "type": "bar",
                "theme": "dark",
                "showLegend": true,
                "animate": true,
                "color": "#6366f1"
            }
        }
    }'>
        <header class="header">
            <h1>@yacobolo/datastar-prop</h1>
            <p>Property binding for Lit web components with deep reactivity</p>
            <div class="badges">
                <a href="https://github.com/yacobolo/datastar-prop" class="badge" target="_blank">GitHub</a>
                <a href="https://www.npmjs.com/package/@yacobolo/datastar-prop" class="badge" target="_blank">npm</a>
                <a href="https://lit.dev" class="badge" target="_blank">Lit</a>
                <a href="https://data-star.dev" class="badge" target="_blank">Datastar</a>
                <span class="badge brand">Deep Reactivity</span>
            </div>
        </header>

        <div class="install">
            <div class="install-label">Install</div>
            <code>npm install @yacobolo/datastar-prop</code>
        </div>

        <!-- Demo 1: Flow Diagram -->
        <div class="demo">
            <div class="demo-header">
                <h2>
                    Flow Diagram
                    <span class="feature-tag">Deep Reactivity</span>
                </h2>
                <p>Pass node and edge arrays to a Lit component. Nested changes trigger updates automatically.</p>
            </div>
            
            <div class="demo-canvas">
                <flow-diagram
                    data-prop:nodes="$flow.nodes"
                    data-prop:edges="$flow.edges"
                    data-prop:config="$flow.config"
                ></flow-diagram>
            </div>
            
            <div class="demo-controls">
                <div class="control-group">
                    <label>Node Size:</label>
                    <input type="range" min="20" max="50" data-attr:value="$flow.config.nodeRadius" data-on:input="$flow.config.nodeRadius = evt.target.valueAsNumber">
                    <span class="value-display" data-text="$flow.config.nodeRadius"></span>
                </div>
                <div class="control-group">
                    <label>Animate:</label>
                    <input type="checkbox" data-attr:checked="$flow.config.animate" data-on:change="$flow.config.animate = evt.target.checked">
                </div>
                <button data-on:click="$flow.nodes[0].color = $flow.nodes[0].color === '#6366f1' ? '#f59e0b' : '#6366f1'">
                    Toggle Input Color
                </button>
                <button class="btn-secondary" data-on:click="$flow.nodes.push({ id: String(Date.now()), label: 'New', x: Math.random() * 300 + 50, y: Math.random() * 200 + 50, color: '#ec4899' })">
                    Add Node
                </button>
            </div>
            
            <div class="demo-code">
                <pre><span class="comment">&lt;!-- Bind arrays and objects to Lit component properties --&gt;</span>
&lt;flow-diagram
    <span class="attr">data-prop:nodes</span>=<span class="value">"$flow.nodes"</span>
    <span class="attr">data-prop:edges</span>=<span class="value">"$flow.edges"</span>
    <span class="attr">data-prop:config</span>=<span class="value">"$flow.config"</span>
&gt;&lt;/flow-diagram&gt;

<span class="comment">&lt;!-- Nested changes like $flow.config.nodeRadius = 40 trigger Lit updates --&gt;</span></pre>
            </div>
        </div>

        <!-- Demo 2: 3D Scene -->
        <div class="demo">
            <div class="demo-header">
                <h2>
                    3D Scene Viewer
                    <span class="feature-tag">requestUpdate()</span>
                </h2>
                <p>Three.js scene controlled by Datastar signals. The plugin calls <code>requestUpdate()</code> for Lit.</p>
            </div>
            
            <div class="demo-canvas">
                <scene-viewer
                    data-prop:config="$scene.config"
                ></scene-viewer>
            </div>
            
            <div class="demo-controls">
                <div class="control-group">
                    <label>Shape:</label>
                    <select data-on:change="$scene.config.shape = evt.target.value">
                        <option value="cube" data-attr:selected="$scene.config.shape === 'cube'">Cube</option>
                        <option value="sphere" data-attr:selected="$scene.config.shape === 'sphere'">Sphere</option>
                        <option value="torus" data-attr:selected="$scene.config.shape === 'torus'">Torus</option>
                        <option value="octahedron" data-attr:selected="$scene.config.shape === 'octahedron'">Octahedron</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Color:</label>
                    <input type="color" data-attr:value="$scene.config.color" data-on:input="$scene.config.color = evt.target.value">
                </div>
                <div class="control-group">
                    <label>Speed:</label>
                    <input type="range" min="0" max="0.05" step="0.005" data-attr:value="$scene.config.rotationSpeed" data-on:input="$scene.config.rotationSpeed = evt.target.valueAsNumber">
                </div>
                <div class="control-group">
                    <label>Wireframe:</label>
                    <input type="checkbox" data-attr:checked="$scene.config.wireframe" data-on:change="$scene.config.wireframe = evt.target.checked">
                </div>
                <div class="control-group">
                    <label>Zoom:</label>
                    <input type="range" min="3" max="10" step="0.5" data-attr:value="$scene.config.cameraZ" data-on:input="$scene.config.cameraZ = evt.target.valueAsNumber">
                </div>
            </div>
            
            <div class="demo-code">
                <pre><span class="comment">&lt;!-- Config object with multiple properties --&gt;</span>
&lt;scene-viewer
    <span class="attr">data-prop:config</span>=<span class="value">"$scene.config"</span>
&gt;&lt;/scene-viewer&gt;

<span class="comment">&lt;!-- Datastar signals are reactive proxies. This plugin ensures
     Lit's lifecycle methods fire when nested values change. --&gt;</span></pre>
            </div>
        </div>

        <!-- Demo 3: Data Chart -->
        <div class="demo">
            <div class="demo-header">
                <h2>
                    Data Chart
                    <span class="feature-tag">Array Binding</span>
                </h2>
                <p>ECharts visualization with reactive data array and theme configuration.</p>
            </div>
            
            <div class="demo-canvas">
                <data-chart
                    data-prop:data="$chart.data"
                    data-prop:config="$chart.config"
                ></data-chart>
            </div>
            
            <div class="demo-controls">
                <div class="control-group">
                    <label>Chart Type:</label>
                    <select data-on:change="$chart.config.type = evt.target.value">
                        <option value="bar" data-attr:selected="$chart.config.type === 'bar'">Bar</option>
                        <option value="line" data-attr:selected="$chart.config.type === 'line'">Line</option>
                        <option value="pie" data-attr:selected="$chart.config.type === 'pie'">Pie</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Color:</label>
                    <input type="color" data-attr:value="$chart.config.color" data-on:input="$chart.config.color = evt.target.value">
                </div>
                <div class="control-group">
                    <label>Legend:</label>
                    <input type="checkbox" data-attr:checked="$chart.config.showLegend" data-on:change="$chart.config.showLegend = evt.target.checked">
                </div>
                <button data-on:click="$chart.data.push({ name: 'New', value: Math.floor(Math.random() * 200) + 50 })">
                    Add Data
                </button>
                <button class="btn-secondary" data-on:click="$chart.data.pop()">
                    Remove Last
                </button>
                <button class="btn-secondary" data-on:click="$chart.data = $chart.data.map(d => ({ ...d, value: Math.floor(Math.random() * 200) + 50 }))">
                    Randomize
                </button>
            </div>
            
            <div class="demo-code">
                <pre><span class="comment">&lt;!-- Bind data arrays and config objects --&gt;</span>
&lt;data-chart
    <span class="attr">data-prop:data</span>=<span class="value">"$chart.data"</span>
    <span class="attr">data-prop:config</span>=<span class="value">"$chart.config"</span>
&gt;&lt;/data-chart&gt;

<span class="comment">&lt;!-- Array mutations like $chart.data.push(...) are detected --&gt;</span></pre>
            </div>
        </div>

        <footer class="footer">
            Built with <a href="https://lit.dev">Lit</a> and <a href="https://data-star.dev">Datastar</a>
        </footer>
    </div>

    <!-- Live Signals Sidebar (always visible) -->
    <live-signals></live-signals>
    
    <!-- Hidden element for Datastar to populate with JSON signals -->
    <pre data-json-signals style="display: none;"></pre>

    <script type="importmap">
        {
            "imports": {
                "datastar": "https://cdn.jsdelivr.net/gh/starfederation/datastar@1.0.0-RC.7/bundles/datastar.js",
                "lit": "https://cdn.jsdelivr.net/npm/lit@3/+esm",
                "lit/decorators.js": "https://cdn.jsdelivr.net/npm/lit@3/decorators.js/+esm",
                "lit/directives/repeat.js": "https://cdn.jsdelivr.net/npm/lit@3/directives/repeat.js/+esm",
                "three": "https://cdn.jsdelivr.net/npm/three@0.160/+esm",
                "echarts": "https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.esm.min.js"
            }
        }
    </script>
    
    <!-- Load everything in correct order -->
    <script type="module">
        console.log('[demo] Starting initialization...')
        
        // 1. Import demo components FIRST - defines custom elements so they're upgraded
        console.log('[demo] Importing demo components...')
        await import('./demo/dist/components.js')
        console.log('[demo] Demo components imported and custom elements defined')
        
        // 2. Import Datastar - will process DOM with already-upgraded elements
        console.log('[demo] Importing Datastar...')
        const Datastar = await import('datastar')
        console.log('[demo] Datastar imported:', Object.keys(Datastar))
        
        // 3. Import and register the prop plugin - elements now have requestUpdate
        console.log('[demo] Importing prop plugin...')
        const { default: propPlugin } = await import('./dist/index.js')
        console.log('[demo] propPlugin imported:', propPlugin)
        
        const plugin = propPlugin(Datastar.effect)
        console.log('[demo] Plugin created:', plugin)
        
        Datastar.attribute(plugin)
        console.log('[demo] Plugin registered via Datastar.attribute()')
        
        // 4. Check if elements exist and have properties
        setTimeout(() => {
            const sceneViewer = document.querySelector('scene-viewer')
            const flowDiagram = document.querySelector('flow-diagram')
            const dataChart = document.querySelector('data-chart')
            
            console.log('[demo] Element check:')
            console.log('  scene-viewer:', sceneViewer, 'hasRequestUpdate:', typeof sceneViewer?.requestUpdate === 'function')
            console.log('  flow-diagram:', flowDiagram, 'hasRequestUpdate:', typeof flowDiagram?.requestUpdate === 'function')
            console.log('  data-chart:', dataChart, 'hasRequestUpdate:', typeof dataChart?.requestUpdate === 'function')
        }, 500)
    </script>
</body>
</html>
